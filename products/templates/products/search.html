{# search.html #}
{# 검색 결과 화면 템플릿 #}

{% extends 'base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'products/css/search.css' %}">
{% endblock styles %}

{% block content %}
<div class="content-wrapper">

  <header class="header">
    <div class="left-group">
      {# 로고 이미지 #}
      <a href="{% url 'products:index' %}" class="main-link">
        <img src="{% static 'images/logo-gray.png' %}" alt="FINBOT Logo">
      </a>
    </div>

    <div class="right-group">
      {% if request.user.is_authenticated %}
        <a href="{% url 'accounts:update' %}" class="info-btn">회원 정보</a>
        <a href="{% url 'accounts:bookmark_list' %}" class="info-btn">관심 상품</a>
        <a href="{% url 'accounts:logout' %}" class="logout-btn">로그아웃</a>
      {% else %}
        <a href="{% url 'accounts:login' %}" class="logout-btn">로그인</a>
      {% endif %}
    </div>
  </header>

  {# 검색 창 #}
  <div class="search-header">
    <form class="search-bar" method="GET" action="{% url 'products:search' %}">
      <div class="search-input-wrapper">
        <input class="search-input" type="text" name="query" value="{{ query }}" placeholder="검색어를 입력하세요">
        <button type="submit" class="search-submit-btn">&#x2315;</button>
      </div>
    </form>
  </div>

  <div class="result-container">
    {% if query %}
        <div class="result-list">
        {% if page_obj %}
          {% for p in page_obj %}
          <div class="result-item">
              <h3>{{ p.fin_prdt_nm }}</h3>

              <div class="info-grid">


                  <div class="label">회사명</div>
                  <div class="value">{{ p.kor_co_nm }}</div>

                  <div class="label">카테고리</div>
                  <div class="value">{{ p.category }}</div>

                  <div class="label">가입 방법</div>
                  <div class="value">{{ p.join_way }}</div>

                  <div class="label">상품 설명</div>
                  <div class="value">{{ p.description }}</div>

                  <form method="POST" action="{% url 'accounts:bookmark' p.fin_prdt_cd %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.get_full_path }}">
                    
                    {% if request.user in p.users.all %}
                      <input type="submit" value="★ 북마크 해제">
                    {% else %}
                      <input type="submit" value="☆ 북마크">
                    {% endif %}
                  </form>
              </div>
          </div>
          {% endfor %}
      
        <div class="pagination">
          {# 이전 페이지 #}
          {% if show_previous_10 %}
            <a href="?query={{ query }}&page={{ previous_page }}">이전</a>
          {% endif %}

          {# 페이지 번호 그룹 표시 (1부터 10까지) #}
          {% for num in page_obj.paginator.page_range %}
            {% if num >= start_page and num <= end_page %}
              {% if num == page_obj.number %}
                <span>{{ num }}</span>
              {% else %}
                <a href="?query={{ query }}&page={{ num }}">{{ num }}</a>
              {% endif %}
            {% endif %}
          {% endfor %}

          {# 다음 페이지 #}
          {% if show_next_10 %}
            <a href="?query={{ query }}&page={{ next_page }}">다음</a>
          {% endif %}
        </div>

        {% else %}
        <div class="no-result">
          <p>검색 결과가 없습니다.</p>
        </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  {# 채팅 페이지 버튼 #}
  <a href="{% url 'chat:current_chat' %}" class="chatbot-btn">
    <img src="{% static 'images/finbot-btn-long.png' %}" alt="FINBOT Chat">
  </a>
</div>
{% endblock content %}