{# chat.html #}
{# AI 채팅 화면 템플릿 #}

{% extends 'base.html' %}
{% load static %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'chatbot/css/chat.css' %}">
{% endblock styles %}

{% block content %}

{# 사이드바 #}
<div id="sidebar" class="sidebar">
    {# 토글 버튼 #}
    <div class="toggle-btn" onclick="toggleSidebar()">
        <span class="toggle-icon">&#x2630;</span> 
    </div>

    <p class="recent-title">최근 대화 목록</p>
    <ul class="chat-list">
      {% for room in rooms %}
        <li>
          <a href="{% url "chat:chat_page" room.pk %}">
            {# 사용자가 채팅방의 이름을 변경한 경우 #}
            {% if room.title %}
              {# 사용자가 머무르는 채팅방에 따라 분기 #}
              {% if room.pk == chatroom_pk %}
                {{ room.title }} 현재 채팅방
              {% else %}
                {{ room.title }}
              {% endif %}
            {# 사용자가 채팅방의 이름을 변경하지 않은 경우 #}
            {% else %}
              {# 사용자가 머무르는 채팅방에 따라 분기 #}
              {% if room.pk == chatroom_pk %}
                채팅방 {{ room.display_id }} 현재 채팅방
              {% else %}
                채팅방 {{ room.display_id }}
              {% endif %}
            {% endif %}
          </a>
          <form action="{% url "chat:chatroom_delete" room.pk %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="채팅방 삭제">
          </form>
          <a href="{% url "chat:chatroom_update" room.pk %}">이름 수정하기</a>
        </li>
      {% endfor %}
      <form action="{% url "chat:chatroom_create" %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="채팅방 생성">
    </form>
    </ul>
    <hr>
    
</div>

<div class="chat-container">

  {# 상단바 #}
  <div class="chat-header">
    <a href="{% url 'products:index' %}" class="nav-link left">HOME</a>
    <a href="{% url 'accounts:logout' %}" class="nav-link right">LOGOUT</a>
  </div>

  {# 채팅 화면 #}
  <div class="chat-main">
    <div class="messages-area">
      {% for msg in messages %}
        {% if msg.role == "user" %}

          {# 사용자의 메시지 #}
          <div class="message-container user-message">
            <div class="bubble">
              {{ msg.message }}
            </div>
          </div>

        {% else %}

          {# 채팅 봇의 메시지 #}
          <div class="message-container bot-message">
            <div class="bubble">
              {{ msg.message }}
            </div>
          </div>
        {% endif %}

      {% empty %}
        <p>아직 대화가 없습니다. 첫 메시지를 입력해보세요!</p>
      {% endfor %}
  </div>
</div>

{# 대화 입력 영역 #}
<form class="input-area" method="POST">
  {% csrf_token %}
  <input id="chat-input" type="text" name="message" placeholder="메시지를 입력해 주세요" required>

  {# 대화 전송 버튼 #}
  <button id="send-btn" type="submit">
    <span style="font-size: 15px; transform: translateX(2px);">▶</span> 
  </button>
</form>

{# 사이드바 토글 로직 (JavaScript) #}
<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('open');
    }
</script>
{% endblock %}