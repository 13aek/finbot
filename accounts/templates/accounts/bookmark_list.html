{# bookmark_list.html #}
{# 관심 상품 조회 화면 템플릿 #}

{% extends 'base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'accounts/css/bookmark-list.css' %}">
{% endblock styles %}

{% block content %}
<div class="content-wrapper">
  {# 상단바 #}
  <header class="header">
    <div class="left-group">
      {# 로고 이미지 #}
      <a href="{% url 'products:index' %}" class="main-link">
        <img src="{% static 'images/logo-gray.png' %}" alt="FINBOT Logo">
      </a>
    </div>

    <div class="right-group">
      <a href="{% url 'accounts:update' %}" class="info-btn">회원 정보</a>
      <a href="{% url 'accounts:logout' %}" class="logout-btn">로그아웃</a>
    </div>
  </header>

  <div class="bookmark-container">
    <h2 class="bookmark-title">
      {{ request.user.display_name }}님의
      <span class="highlight-title">관심 상품 목록</span>
    </h2>

    <div class="product-container">
      {% if page_obj %}
        {% for product in page_obj %}
          <div class="bookmark-item">
            <div class="bookmark-nav">
              <p class="product-name">{{ product.fin_prdt_nm }}</p>

              {# 북마크 버튼 #}
              <form method="POST" action="{% url 'accounts:bookmark' product.fin_prdt_cd %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">

                {# 북마크 취소 #}
                {% if request.user in product.users.all %}
                  <button type="submit" class="bookmark-btn bookmarked">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M12 3.5l2.3 4.7 5.2.8-3.8 3.7.9 5.2L12 15.8l-4.6 2.4.9-5.2-3.8-3.7 5.2-.8L12 3.5z" fill="currentColor">
                    </svg>
                  </button>

                {# 북마크 등록 #}
                {% else %}
                  <button type="submit" class="bookmark-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M12 3.5l2.3 4.7 5.2.8-3.8 3.7.9 5.2L12 15.8l-4.6 2.4.9-5.2-3.8-3.7 5.2-.8L12 3.5z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round">
                    </svg>
                  </button>
                {% endif %}
              </form>
            </div>

            <p style="font-weight: bold">{{ product.kor_co_nm }}</p>
            <p>{{ product.description }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p class="no-item">아직 등록한 관심 상품이 없습니다.
        마음에 드는 상품을 추가해 보세요.</p>
      {% endif %}
    </div>

    <div class="pagination">
      {# 이전 페이지 #}
      {% if show_previous_5 %}
        <a href="?query={{ query }}&page={{ previous_page }}">이전</a>
      {% endif %}

      {# 페이지 번호 그룹 표시 (1부터 5까지) #}
      {% for num in page_obj.paginator.page_range %}
      {% if num >= start_page and num <= end_page %}
      {% if num == page_obj.number %}
      <span>{{ num }}</span>
      {% else %}
        <a href="?query={{ query }}&page={{ num }}">{{ num }}</a>
      {% endif %}
      {% endif %}
      {% endfor %}

      {# 다음 페이지 #}
      {% if show_next_5 %}
        <a href="?query={{ query }}&page={{ next_page }}">다음</a>
      {% endif %}
    </div>
  </div>

  {# 채팅 페이지 버튼 #}
  <a href="{% url 'chat:current_chat' %}" class="chatbot-btn">
    <img src="{% static 'images/finbot-btn-long.png' %}" alt="FINBOT Chat">
  </a>
</div>
{% endblock content %}